<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"> 


<h:head>IGNORED</h:head>
<h:body>
	<ui:composition template="../../templates/admin2_layout.xhtml">
		<ui:define name="content">
			<h:form id="editMembersForm">
				
				<p:growl id="messages" showSummary="true" showDetail="true"/>
				<h:inputHidden id="id" value="#{communitiesSBean.selectedItem.id}"/>
				
				<div class="row">
		           	<div class="col-md-offset-1 col-md-10"> 
					  	<ul class="nav nav-tabs" role="tablist">
						    <li role="presentation" class="active"><a href="#default" aria-controls="default" role="tab" data-toggle="tab">Subscriciones</a></li>
						    <li  role="presentation"> <a href="#advanced" aria-controls="advanced" role="tab" data-toggle="tab">Avanzado</a></li>
					  	</ul>
					</div>
				</div>	 
				
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="default">
					
						<div class="row">
							<div class="col-md-offset-1 col-md-3">
								...
								<h:panelGroup id="counters">
									<ul class="list-group">
	  									<li class="list-group-item">
	    									<span class="badge">#{editMembershipBBean.adminCounter}</span>
	    									Administradores
	  									</li>
	  									<li class="list-group-item">
	    									<span class="badge">#{editMembershipBBean.pendingsCounter}</span>
	    									Suscripciones en espera
	  									</li>
	  									<li class="list-group-item">
	    									<span class="badge">#{editMembershipBBean.membersCounter}</span>
	    									Miembros activos
	  									</li>
	  									<li class="list-group-item list-group-item-info">
	    									<span class="badge">#{editMembershipBBean.summary}</span>
	    									Total
	  									</li>
									</ul>		
								</h:panelGroup>					
							</div>
							<div class="col-md-offset-1 col-md-6">
								Suscripciones pendientes	
								<p:messages id="membership_msgs" showSummary="true" showDetail="true"/>
								<h:outputLabel class="well" id="noPendingsMsg" rendered="#{editMembershipBBean.pendingsCounter==0?'true':'false'}" value="No hay suscripciones pendientes." />
								<c:forEach items="#{editMembershipBBean.pendings}" var="pending" varStatus="status">							
									<div id="m#{pending.memberId}" class="collapse in">
										<div class="panel panel-default">
											  <div  class="panel-body">
		    									<h6 class="list-group-item-heading">#{pending.nickname}<small>-(#{pending.joinningDate})</small></h6>
		    									<p class="list-group-item-text">#{pending.application}</p>
		    									
		    									
		    									
		    									<div id="btnsPanel#{status.index}" class="collapse in text-right" > 
		    										
		    										<h:commandLink  title="Rechazar suscripci贸n." onclick="$('#rejectPanel#{status.index}').collapse('show');$('#btnsPanel#{status.index}').collapse('hide');">		
		    											<f:ajax render=":editMembersForm:membership_msgs"/>													
														<span class="fa-stack fa-1x">
															<i class="fa fa-circle fa-stack-2x" style="color: red;"></i>
															<i class="fa fa-close fa-stack-1x fa-inverse"></i>
														</span>											
													</h:commandLink>
													
		    										<h:commandLink title="Aceptar suscripci贸n." onclick="$('#m#{pending.memberId}').collapse('hide');" action="#{editMembershipCBean.approve(pending)}">
		    											<f:ajax render=":editMembersForm:counters :editMembersForm:membership_msgs :editMembersForm:noPendingsMsg" />
														<span class="fa-stack fa-1x">
															<i class="fa fa-circle fa-stack-2x" style="color: green;"></i>
															<i class="fa fa-check fa-stack-1x fa-inverse"></i>
														</span>											
													</h:commandLink> 
		    										
		    									</div>
		    									<div id="rejectPanel#{status.index}" class="collapse">
			    									<h6 style="color: red;">Esta suscripci贸n va a ser rechazada</h6> 
			    									<div class="form-group">
														<label for="notes">#{msgs['editmembership.reject']} </label>
														<p:inputTextarea class="form-control" id="notes" value="#{pending.rejectionReason}"
															rows="5" cols="58" maxlength="255" counter="display"
															counterTemplate="#{msgs['editaccount.remaining_chars']}" />
														<p:outputLabel id="display" />
											 	 	</div>
											 	 	<div class="text-right"> 
			    										<h:commandLink   class="btn btn-default btn-sm" onclick="$('#rejectPanel#{status.index}').collapse('hide');$('#btnsPanel#{status.index}').collapse('show');" value="Cancelar" >															
																<f:ajax render=":editMembersForm:membership_msgs"/>										
														</h:commandLink>
														
			    										<h:commandLink  class="btn btn-default btn-sm" onclick="$('#m#{pending.memberId}').collapse('hide');" value="Enviar" action="#{editMembershipCBean.reject(pending)}">
			    												<f:ajax render=":editMembersForm:counters :editMembersForm:membership_msgs :editMembersForm:noPendingsMsg"/>											
														</h:commandLink> 
			    									</div>
		    									</div>
		  									  </div>  <!-- de panel-body -->	
										</div> <!-- de panel -->
									</div><!-- de collapseOne -->
								</c:forEach>
							</div> <!-- de md -->
						</div> <!-- de row -->
					</div> <!--  de tabpanel -->

					<div role="tabpanel" class="tab-pane" id="advanced">
					
						<div class="row">
							<div class="hidden-xs hidden-sm col-md-offset-1 col-md-10">
								....	
								<p:dataTable id="membersTable" var="member" value="#{editMembershipBBean.members}"
									tableStyleClass="ui-table-columntoggle" 					
									paginator="true" 
									rows="8"
									widgetVar="membersTable"
									resizableColumns="true"
									paginatorPosition="bottom"
				                	paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				                	lazy="true"> 
				        		
					        		<p:column width="50">
			            				<p:rowToggler />
			        				</p:column>	 
					        		<p:column id="alias_column" class="rsrcColumn1" headerText="#{msgs['editcommunity.member_alias']}" sortBy="#{member.nickname}" filterBy="#{member.nickname}" >
					            		#{member.nickname}
					        		</p:column>
					        		<p:column id="profile_column" class="rsrcColumn2"  priority="4" headerText="#{msgs['editcommunity.member_profile']}" sortBy="#{member.memberProfile.description}">
									 	<p:selectBooleanCheckbox value="#{member.admin}">
			            					<p:ajax update=":editMembersForm:messages :editMembersForm:membersTable" listener="#{editMembershipCBean.saveMemberProfile(member)}" />
			        					</p:selectBooleanCheckbox>	
						        	</p:column>
					    	    	<p:column id="status_column" class="rsrcColumn3" priority="2" headerText="#{msgs['editcommunity.member_status']}" sortBy="#{member.status}">
					            		<p:selectBooleanCheckbox value="#{member.pendingMembership}">
			            					<p:ajax update=":editMembersForm:messages" listener="#{editMembershipCBean.saveMembershipStatus(member)}" />
			        					</p:selectBooleanCheckbox>	
					        		</p:column>
					    	    	<p:column class="rsrcColumn4" priority="3" headerText="#{msgs['editcommunity.member_subscription']}" sortBy="#{member.joinningDate}">
					        	    	<h:outputText value="#{member.joinningDate}" />
					        		</p:column>
					        		<p:column class="rsrcColumn5">
						        		<ul class="social-network">
											<li>
												<h:commandLink update=":editMembersForm:confirm_remove" 
														oncomplete="PF('summaryConfirmDialog').show();" 
														title="#{msgs['editcommunity.unsubscribe']}">
													<span class="fa-stack fa-1x">
													<i class="fa fa-circle fa-stack-2x"></i>
													<i class="fa fa-sign-out fa-stack-1x fa-inverse"></i>
													</span>
													<f:setPropertyActionListener value="#{member}" target="#{editMembershipBBean.selectedMember}" />
												</h:commandLink>
											</li>
										</ul>
					        		</p:column>
					        		<p:rowExpansion>
					        			<div style="white-space: pre-wrap">
					        				<h:outputText value="#{member.mydata}" styleClass="white-space:pre-wrap;"/>
					        			</div>
					        		</p:rowExpansion>
								</p:dataTable>
							</div>
							<!-- Tabla para m贸viles (menos de 780px)  -->
							<div class="hidden-md hidden-lg col-md-offset-1 col-md-10">			
								<p:dataTable id="membersTable2" var="member" value="#{editMembershipBBean.members}"
									tableStyleClass="ui-table-columntoggle" 					
									paginator="true" 
									rows="8"
									widgetVar="membersTable"
									resizableColumns="true"
									paginatorPosition="bottom"
					               	paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					               	lazy="true"> 
				   					<p:column width="50">
			            				<p:rowToggler />
			        				</p:column>	 
					        		<p:column id="alias_column2" headerText="#{msgs['editcommunity.member_alias']}" sortBy="#{member.nickname}" >
					            			<h:outputText id="alias" value="#{member.nickname}" title="#{member.mydata}"/>
					        		</p:column>
					        		<p:column id="status_column2" class="rsrcColumn3" headerText="#{msgs['editcommunity.member_status']}" sortBy="#{member.status}">
					    	    		<p:selectBooleanCheckbox value="#{member.pendingMembership}">
			            					<p:ajax update=":editMembersForm:messages" listener="#{editMembershipCBean.saveMembershipStatus(member)}" />
			        					</p:selectBooleanCheckbox>
									</p:column>
									<p:rowExpansion>
					        			<div style="white-space: pre-wrap">
					        				<h:outputText value="#{member.mydata}" styleClass="white-space:pre-wrap;"/>
					        			</div>
					        		</p:rowExpansion>
								</p:dataTable>
							</div>
						</div> 
					</div>  <!-- Del tabpanel advanced -->
				</div>
				
				
			
			<p:dialog
				header="#{msgs['editcommunity.unsubscribe_confirm_header']}"
				widgetVar="summaryConfirmDialog">
				<p:outputPanel id="confirm_remove">
					<p:outputPanel styleClass="ui-icon ui-confirm-dialog-severity ui-icon-alert display-inline-block">
					</p:outputPanel>
      				#{msgs['editcommunity.unsubscribe_confirm_msg']} #{editMembershipBBean.selectedMember.nickname} 
   				</p:outputPanel>
				<p:commandButton value="#{msgs['editcommunity.unsubscribe_yes']}"
					update=":editMembersForm:membersTable" 
					onstart="setUpOnStart();"
					oncomplete="setUpOnComplete();"
					actionListener="#{editMembershipCBean.unsubscribe}"
					icon="ui-icon-check" />
				<p:commandButton value="#{msgs['editcommunity.unsubscribe_no']}"
					onclick="PF('summaryConfirmDialog').hide();" type="button"
					icon="ui-icon-close" />
			</p:dialog>
				
				<p:messages id="membership_messages"/>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>